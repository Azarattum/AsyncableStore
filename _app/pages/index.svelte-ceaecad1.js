var be=Object.defineProperty;var se=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var ae=(n,t,e)=>t in n?be(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,ce=(n,t)=>{for(var e in t||(t={}))he.call(t,e)&&ae(n,e,t[e]);if(se)for(var e of se(t))me.call(t,e)&&ae(n,e,t[e]);return n};import{N as ie,S as ge,i as ve,s as ye,O as K,e as A,t as L,k as q,c as N,a as C,h as D,d as f,m as z,b as I,g as S,M as m,P as ue,Q as ke,R as fe,E as _,T as pe,j as W}from"../chunks/index-455dabf4.js";import{d as Oe,w as we}from"../chunks/index-9200485f.js";function Te(n,t){const e=Object.getPrototypeOf(Object(n)),l=Object.create(e);Object.setPrototypeOf(l,e);for(const s of Object.getOwnPropertyNames(e))if(typeof n!="object"){const{value:p,get:g,set:i}=Object.getOwnPropertyDescriptor(e,s)||{};typeof p=="function"&&Object.defineProperty(l,s,{value:p.bind(n)}),(g||i)&&Object.defineProperty(l,s,{get:g==null?void 0:g.bind(n),set:i==null?void 0:i.bind(n)})}const r=ce({},t);return Object.setPrototypeOf(r,l),r}function B(n,t){const e=Object.create(null);typeof t=="object"&&Object.assign(e,t);const l=()=>(console.warn("Trying to access an empty object! Maybe you forgot a 'ready($data)' check?"),"[object Empty]"),r={[Symbol.toPrimitive]:()=>t,valueOf:()=>{var p;return((p=t==null?void 0:t.valueOf)==null?void 0:p.call(t))||t},toString:()=>t==null?l():String(t),then:n.then.bind(n),catch:n.catch.bind(n),finally:n.finally.bind(n)},s=Te(t,r);return Object.setPrototypeOf(e,s),e}function je(n){Array.isArray(n)||(n=[n]),typeof n[1]=="boolean"&&(n=[n]);const t=[],e=[];for(const l of n){let r=l,s=!1;Array.isArray(l)&&([r,s]=l),t.push(r),s&&typeof r.update=="function"&&e.push(r)}return{stores:t,reflections:e}}function V(n=!0){const t=new AbortController,e={state:n?"pending":"resolved",signal:t.signal};return e.value=new Promise((l,r)=>{e.resolve=l,e.reject=r}),e.adopt=l=>{t.abort(),l.then(e.resolve,e.reject),e.reject=()=>{},e.resolve=()=>{},e.state==="pending"&&(e.state="adopted")},e.value.then(()=>e.state="resolved",()=>e.state="rejected"),e}function de(n){return n.valueOf()!=null}function _e(n,t,e){const l=typeof n=="function"?n:t,r=typeof n=="function"?t:e,s=typeof n=="function"?[]:n,{stores:p,reflections:g}=je(s);let i,u=V(!1),v=V(),a;const R=B(v.value),J=Oe(p,h=>h),M=async h=>{if(u.state==="pending")return u.value;h||(h=i||ie(J),i=void 0);const o=V();try{v.state==="pending"?v.adopt(o.value):b.set(B(o.value,a)),v=o;const y=await Promise.all(h);if(o.state==="adopted")return o.value;if(JSON.stringify(y)!==JSON.stringify(i)){const k=await l(o.signal,y);if(o.state==="adopted")return o.value;i=y,k!==a&&(a=k,b.set(B(o.value,a)))}o.resolve(a)}catch(y){o.reject(y)}},b=we(R,()=>J.subscribe(M)),E=async h=>{if(h===a)return;const o=V();v.state==="pending"&&v.adopt(o.value),u.state==="pending"&&u.adopt(o.value),u=o;const y=a;a=h,b.set(B(Promise.resolve(a),a));try{if(!i&&(i=await Promise.all(ie(J)),o.state==="adopted"))return o.value;const k=await(r==null?void 0:r(o.signal,[a,y],i));if(o.state==="adopted")return o.value;k!=null&&a!==k&&(a=k,b.set(B(Promise.resolve(a),a))),JSON.stringify(a)!=JSON.stringify(y)&&g.map(T=>T.update())}catch(k){throw a=y,b.set(B(v.value,a)),k}finally{o.resolve(a)}},H=async h=>{if(!h)return M();if(!r)return;const o=await h(a);o!=null&&await E(o)};return r?{subscribe:b.subscribe,set:E,update:H}:{subscribe:b.subscribe,update:H}}function Pe(n){let t;return{c(){t=L("Loading")},l(e){t=D(e,"Loading")},m(e,l){S(e,t,l)},p:_,d(e){e&&f(t)}}}function Se(n){let t;return{c(){t=L(n[1])},l(e){t=D(e,n[1])},m(e,l){S(e,t,l)},p(e,l){l&2&&W(t,e[1])},d(e){e&&f(t)}}}function Ee(n){return{c:_,l:_,m:_,p:_,d:_}}function Ae(n){let t=n[6]+"",e;return{c(){e=L(t)},l(l){e=D(l,t)},m(l,r){S(l,e,r)},p(l,r){r&2&&t!==(t=l[6]+"")&&W(e,t)},d(l){l&&f(e)}}}function Ne(n){let t;return{c(){t=L("Loading")},l(e){t=D(e,"Loading")},m(e,l){S(e,t,l)},p:_,d(e){e&&f(t)}}}function Ce(n){let t;return{c(){t=L("Loading")},l(e){t=D(e,"Loading")},m(e,l){S(e,t,l)},p:_,d(e){e&&f(t)}}}function Le(n){let t;return{c(){t=L(n[2])},l(e){t=D(e,n[2])},m(e,l){S(e,t,l)},p(e,l){l&4&&W(t,e[2])},d(e){e&&f(t)}}}function De(n){return{c:_,l:_,m:_,p:_,d:_}}function Re(n){let t=n[6]+"",e;return{c(){e=L(t)},l(l){e=D(l,t)},m(l,r){S(l,e,r)},p(l,r){r&4&&t!==(t=l[6]+"")&&W(e,t)},d(l){l&&f(e)}}}function Ie(n){let t;return{c(){t=L("Loading")},l(e){t=D(e,"Loading")},m(e,l){S(e,t,l)},p:_,d(e){e&&f(t)}}}function Je(n){let t,e,l,r,s,p,g,i,u,v,a,R,J,M,b,E,H,h,o,y,k,T,Y,Z;function x(d,c){return c&2&&(v=null),v==null&&(v=!!de(d[1])),v?Se:Pe}let Q=x(n,-1),j=Q(n),O={ctx:n,current:null,token:null,hasCatch:!1,pending:Ne,then:Ae,catch:Ee,value:6};K(J=n[1],O);function $(d,c){return c&4&&(H=null),H==null&&(H=!!de(d[2])),H?Le:Ce}let U=$(n,-1),P=U(n),w={ctx:n,current:null,token:null,hasCatch:!1,pending:Ie,then:Re,catch:De,value:6};return K(y=n[2],w),{c(){t=A("table"),e=A("th"),l=L("Strategy 1"),r=q(),s=A("th"),p=L("Strategy 2"),g=q(),i=A("tr"),u=A("td"),j.c(),a=q(),R=A("td"),O.block.c(),M=q(),b=A("tr"),E=A("td"),P.c(),h=q(),o=A("td"),w.block.c(),k=q(),T=A("textarea"),this.h()},l(d){t=N(d,"TABLE",{class:!0});var c=C(t);e=N(c,"TH",{class:!0});var ee=C(e);l=D(ee,"Strategy 1"),ee.forEach(f),r=z(c),s=N(c,"TH",{class:!0});var te=C(s);p=D(te,"Strategy 2"),te.forEach(f),g=z(c),i=N(c,"TR",{});var X=C(i);u=N(X,"TD",{class:!0});var ne=C(u);j.l(ne),ne.forEach(f),a=z(X),R=N(X,"TD",{class:!0});var le=C(R);O.block.l(le),le.forEach(f),X.forEach(f),M=z(c),b=N(c,"TR",{});var G=C(b);E=N(G,"TD",{class:!0});var re=C(E);P.l(re),re.forEach(f),h=z(G),o=N(G,"TD",{class:!0});var oe=C(o);w.block.l(oe),oe.forEach(f),G.forEach(f),c.forEach(f),k=z(d),T=N(d,"TEXTAREA",{type:!0,class:!0}),C(T).forEach(f),this.h()},h(){I(e,"class","svelte-i41lg3"),I(s,"class","svelte-i41lg3"),I(u,"class","svelte-i41lg3"),I(R,"class","svelte-i41lg3"),I(E,"class","svelte-i41lg3"),I(o,"class","svelte-i41lg3"),I(t,"class","svelte-i41lg3"),I(T,"type","text"),I(T,"class","svelte-i41lg3")},m(d,c){S(d,t,c),m(t,e),m(e,l),m(t,r),m(t,s),m(s,p),m(t,g),m(t,i),m(i,u),j.m(u,null),m(i,a),m(i,R),O.block.m(R,O.anchor=null),O.mount=()=>R,O.anchor=null,m(t,M),m(t,b),m(b,E),P.m(E,null),m(b,h),m(b,o),w.block.m(o,w.anchor=null),w.mount=()=>o,w.anchor=null,S(d,k,c),S(d,T,c),ue(T,n[0]),Y||(Z=ke(T,"input",n[5]),Y=!0)},p(d,[c]){n=d,Q===(Q=x(n,c))&&j?j.p(n,c):(j.d(1),j=Q(n),j&&(j.c(),j.m(u,null))),O.ctx=n,c&2&&J!==(J=n[1])&&K(J,O)||fe(O,n,c),U===(U=$(n,c))&&P?P.p(n,c):(P.d(1),P=U(n),P&&(P.c(),P.m(E,null))),w.ctx=n,c&4&&y!==(y=n[2])&&K(y,w)||fe(w,n,c),c&1&&ue(T,n[0])},i:_,o:_,d(d){d&&f(t),j.d(),O.block.d(),O.token=null,O=null,P.d(),w.block.d(),w.token=null,w=null,d&&f(k),d&&f(T),Y=!1,Z()}}}const F=2e3;function He(n,t,e){let l,r,s=`[ACTION]: Initialized.
`;const p=_e(async()=>(e(0,s+=`  Parent starts loading.
`),await new Promise(u=>setTimeout(u,F)),e(0,s+=`  Parent loaded.
`),"Some Data"),async()=>(e(0,s+=`  Parent starts updating.
`),await new Promise(u=>setTimeout(u,F)),e(0,s+=`  Parent updated.
`),"New Real"));pe(n,p,u=>e(1,l=u));const g=_e([p,!0],async(u,[v])=>(await new Promise(a=>setTimeout(a,F/10)),e(0,s+=`  Child derived data.
`),`Derived: ${v}`),()=>{});pe(n,g,u=>e(2,r=u)),setTimeout(()=>{e(0,s+=`[ACTION]: Force parent update.
`),p.update()},F*2),setTimeout(()=>{e(0,s+=`[ACTION]: Set parent value.
`),p.set("New Optimistic")},F*4),setTimeout(()=>{e(0,s+=`[ACTION]: Set child value.
`),g.set("Update from child!")},F*6);function i(){s=this.value,e(0,s)}return[s,l,r,p,g,i]}class Be extends ge{constructor(t){super(),ve(this,t,He,Je,ye,{})}}export{Be as default};
